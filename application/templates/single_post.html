{% extends "base.html" %}
{% block body %}
<h1> {{ post.title }}</h1>
<div id="vote_count">{{ post.vote_count }}</div>
<p>

<a href="#" OnClick="DoAction('{{post.vote_count}}');" >Vote</a>
</p>

<p>
{{ post.body }}
</p>
<div id="comment" deep="0">
    {% include "comments.html" %}
</div>
<h1>Add comment</h1>
<form action="{{ url_for('singlepost', postid=post.id  ) }}" method="post" class="form-horizontal comment_form">
    <div class="control-group">
        <div class="controls">
             {{form.hidden_tag()}}
                <p>
                {{ form.text.label }}:<br>
                {{form.text(size=80)}}<br>
                {% if form.errors %}
                    <ul class=errors>
                     {% for error in form.errors %}
                      <li>{{ error }}</li>
                    {% endfor %}
                    </ul>
                {% endif %}
              </p>

        </div>
    </div>

    <div class="control-group">
        <div class="controls">
          <button type="submit" class="btn btn-success">Add comment</button>
        </div>
    </div>
  </form>
<script type="text/javascript">


function DoAction(   )
{
    alert(123);
    $.ajax({
         type: 'POST',
         url: "{{ url_for('like_post', postid=post.id) }}",
         success: function(data){
             $('#vote_count').html(data);
         }
    });
}

$(document).ready(function () {
    $(".comment_form").submit(function (form) {

        alert($('textarea[name="text"]').val());
        $.ajax({
            type: "POST",
            url: $(".comment_form").attr('action'),
            data: $(".comment_form").serialize(),
            success: function (data) {
                $("#comment").html(data.comments);
                $('textarea#text').val("");

            },
            error: function (xhr, str) {
                alert('Mistake ' + xhr.responseCode);
            }
        });
        form.preventDefault();
    });
});
</script>
{% endblock %}
