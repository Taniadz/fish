

{#all comment to post on page "single_post"#}
{% macro post_comment_macro(comment, dict_like) -%}
    <div class="one_comment" id="comment{{ comment.id }}">
        {% if current_user.avatar.min %}
            <a href="{{ url_for("user", username=comment.com_author.username) }}"> <img
                    src="{{ url_for('static',filename="media/" + comment.com_author.avatar_min) }}"
                    class="leftimg"/></a>
        {% endif %}
        <div class="description">
            {% if comment.image %}
                <img src="{{ url_for('static',filename="media/" + comment.image) }}" class="leftimg"/>
            {% endif %}

            <span class="comment_text">
                                {{ comment.text }}
                            </span><br>
            <p class="under_comment">
                {% if current_user.is_authenticated %}

                    {% if dict_like[comment.id] %}

                        <div class="smile-container">
                            <div class="parent_div">

                                {{ popup_div_macro(comment.id, "like_comment ") }}

                                {% if dict_like[comment.id] == "like" %}
                                    <img class="liked" src="{{ url_for('static',filename="image/like_smile.png" ) }}"
                                         obj_id={{ comment.id }} url = "like_comment" />

                                {% elif dict_like[comment.id] == "unlike" %}
                                    <img class="liked" src="{{ url_for('static',filename="image/unlike_smile.png" ) }}"
                                         obj_id={{ comment.id }} url = "like_comment"  />

                                {% elif dict_like[comment.id] == "funny" %}
                                    <img class="liked" src="{{ url_for('static',filename="image/funny.png" ) }}"
                                         obj_id={{ comment.id }} url = "like_comment" />


                                {% elif dict_like[comment.id] == "angry" %}
                                    <img class="liked" src="{{ url_for('static',filename="image/angry.png" ) }}"
                                         obj_id="{{ comment.id }}" url = "like_comment"  />


                                {% endif %}
                            </div>
                        </div>

                    {% else %}

                        <div class="smile-container">
                            <div class="parent_div">

                                {{ popup_div_macro(comment.id, "like_comment ") }}
                                <img class="unliked" src="{{ url_for('static',filename="image/gray.png" ) }}"
                                     url="like_comment" obj_id="{{ comment.id }}"/>
                            </div>
                        </div>

                    {% endif %}
                    <span id="like_count_like_comment_{{ comment.id }}">{{ comment.like_count }} </span>
                    <img class="smile" src="{{ url_for('static',filename="image/like_smile.png" ) }}" width=20/>
                    <span id="unlike_count_like_comment_{{ comment.id }}">{{ comment.unlike_count }} </span>
                    <img class="smile" src="{{ url_for('static',filename="image/unlike_smile.png" ) }}" width=20/>
                    <span id="funny_count_like_comment_{{ comment.id }}">{{ comment.funny_count }} </span>
                    <img class="smile" src="{{ url_for('static',filename="image/funny.png" ) }}" width=20/>
                    <span id="angry_count_like_comment_{{ comment.id }}">{{ comment.angry_count }} </span>
                    <img class="smile" src="{{ url_for('static',filename="image/angry.png" ) }}" width=20/>

                {% else %}
                    <span>{{ comment.like_count }}</span>&nbsp;
                    <img class="anon_like" src="{{ url_for('static',filename="image/white.png" ) }}"
                         width="20"/>
                {% endif %}


            <span class="comment_inf">
                                Comment by {{ comment.com_author.username }} [{{ comment.timestamp }}]
                            </span>
            {% if current_user != comment.com_author %}
                <span class="discussion" id="{{ comment.id }}"
                      user="{{ comment.com_author.username }}"
                      post_id = "{{ comment.post_id }}"  >Discussion</span>
                <div class=answer id="answer{{ comment.id }}" style="display: none">

                </div>
            {% endif %}
            </p>
        </div>
        {% if current_user == comment.com_author %}
            {{ comment.id }}
            <div class="btn-group btn-xs post_com_edit" id="edit{{ comment.id }}">
                <button type="button" class="btn btn-default btn-xs dropdown-toggle " data-toggle="dropdown">Edit <span
                        class="caret"></span></button>
                <ul class="dropdown-menu" role="menu">
                    <li><a href="#" onclick="edit_comment(event, {{ comment.id }}, '/edit_post_comment');">edit</a></li>
                    <li><a href="#"
                           onclick="delete_comment(event, {{ comment.id }}, '/delete_post_comment');">delete</a></li>

                </ul>
            </div>

        {% endif %}
    </div>
{%- endmacro %}


{#all comment to product on page "single_product"#}
{% macro product_comment_macro(comment, dict_like) -%}
    <div class="one_comment" id="comment{{ comment.id }}">
        {% if current_user.avatar_min %}
            <a href="{{ url_for("user", username=comment.com_author.username) }}"> <img
                    src="{{ url_for('static',filename="media/" + comment.com_author.avatar_min) }}"
                    class="leftimg"/></a>
        {% endif %}

        <div class="description">
            <div class="comment_image">
                {% if comment.image %}
                    <img src="{{ url_for('static',filename="media/" + comment.image) }}" width=100px/>
                {% endif %}
            </div>
            <span class="comment_text">
                                {{ comment.text }}
                            </span><br>
            <p class="under_comment">
                {% if current_user.is_authenticated %}
                    {% if dict_like[comment.id] %}

                        <div class="smile-container">
                            <div class="parent_div">

                                {{ popup_div_macro(comment.id, "like_prodcomment ") }}

                                {% if dict_like[comment.id] == "like" %}
                                    <img class="liked" src="{{ url_for('static',filename="image/like_smile.png" ) }}"
                                         obj_id="{{ comment.id }}" url = "like_prodcomment" />

                                {% elif dict_like[comment.id] == "unlike" %}
                                    <img class="liked" src="{{ url_for('static',filename="image/unlike_smile.png" ) }}"
                                         obj_id="{{ comment.id }}" url = "like_prodcomment"  />

                                {% elif dict_like[comment.id] == "funny" %}
                                    <img class="liked" src="{{ url_for('static',filename="image/funny.png" ) }}"
                                         obj_id="{{ comment.id }}" url = "like_prodcomment" />


                                {% elif dict_like[comment.id] == "angry" %}
                                    <img class="liked" src="{{ url_for('static',filename="image/angry.png" ) }}"
                                         obj_id="{{ comment.id }}" url = "like_prodcomment"  />


                                {% endif %}
                            </div>
                        </div>

                    {% else %}

                        <div class="smile-container">
                            <div class="parent_div">

                                {{ popup_div_macro(comment.id, "like_prodcomment ") }}
                                <img class="unliked" src="{{ url_for('static',filename="image/gray.png" ) }}"
                                     url="like_prodcomment" obj_id="{{ comment.id }}"/>
                            </div>
                        </div>

                    {% endif %}
                    <span id="like_count_like_prodcomment_{{ comment.id }}">{{ comment.like_count }} </span>
                    <img class="smile" src="{{ url_for('static',filename="image/like_smile.png" ) }}" width=20/>
                    <span id="unlike_count_like_prodcomment_{{ comment.id }}">{{ comment.unlike_count }} </span>
                    <img class="smile" src="{{ url_for('static',filename="image/unlike_smile.png" ) }}" width=20/>
                    <span id="funny_count_like_prodcomment_{{ comment.id }}">{{ comment.funny_count }} </span>
                    <img class="smile" src="{{ url_for('static',filename="image/funny.png" ) }}" width=20/>
                    <span id="angry_count_like_prodcomment_{{ comment.id }}">{{ comment.angry_count }} </span>
                    <img class="smile" src="{{ url_for('static',filename="image/angry.png" ) }}" width=20/>


                {% else %}
                    <span>{{ comment.vote_count }}</span>&nbsp;
                    <img class="anon_like" src="{{ url_for('static',filename="image/white.png" ) }}"
                         width="20"/>
                {% endif %}


            <span class="comment_inf">
                                Comment by {{ comment.com_author.username }} [{{ comment.timestamp }}]
                            </span>
            {% if current_user != comment.com_author %}
                <span class="discussion" id="{{ comment.id }}"
                      user="{{ comment.com_author.username }}"
                        product_id="{{ comment.product_id }}">Discussion</span>
                <div class=answer id="answer{{ comment.id }}" style="display: none">

                </div>
            {% endif %}
            </p>
        </div>
        {% if current_user == comment.com_author %}
            <div class="btn-group btn-xs prod_com_edit" id="edit{{ comment.id }}">
                <button type="button" class="btn btn-default btn-xs dropdown-toggle " data-toggle="dropdown">Edit <span
                        class="caret"></span></button>
                <ul class="dropdown-menu" role="menu">
                    <li><a href="#" onclick="edit_comment(event, {{ comment.id }}, '/edit_prod_comment');">edit</a></li>
                    <li><a href="#" onclick="delete_comment(event, {{ comment.id }}, '/delete_prod_comment');">delete</a>
                    </li>

                </ul>
            </div>

        {% endif %}

    </div>
{%- endmacro %}


{% macro comment_edit(url, comment) -%}
    <form action="{{ url_for( url, comment_id=comment.id ) }}" method="post"
          enctype="multipart/form-data" class="form-horizontal edit_comment">
        <p>
            {{ form.text(class_="form-control my_textarea", rows="2") }}
            {{ form.file }}<br>


            {% if form.errors %}
                <ul class=errors>
                    {% for error in form.errors %}
                        <li>{{ error }}</li>
                    {% endfor %}
                </ul>
            {% endif %}
        </p>


        <div class="control-group">
            <div class="controls">
                <button type="submit" class="btn btn-success">Add comment</button>
            </div>
        </div>
    </form>
{%- endmacro %}


{% macro posts_macro(post, dict, list_of_favourite) -%}

    <div class="post_container">
        <h4><a href="{{ url_for('singlepost', postid=post.id) }}">{{ post.title }}</a></h4>
        {{ dict[post.id]  }}

        {% if post.image %}
            <div class="is_image">
                <img class="img-responsive" src="{{ url_for('static',filename="media/" + post.image) }}"/><br>
                {{ post.body|truncate(95, True) }}
            </div>
        {% else %}
            {{ post.body|truncate(400, True) }}<br>

        {% endif %}
        <span>   Write {{ post.author.username }} at: <b>{{ post.published_at }}</b> </span><br>
        <hr class="myhrline"/>


            {% if dict[post.id] %}


                <div class="smile-container">
                <div class="parent_div">

                {{ popup_div_macro(post.id, "like_post ") }}

                {% if dict[post.id] == "like" %}
                    <img class="liked" src="{{ url_for('static',filename="image/like_smile.png" ) }}"
                         obj_id="{{ post.id }}" url = "like_post" />

                {% elif dict[post.id] == "unlike" %}
                    <img class="liked" src="{{ url_for('static',filename="image/unlike_smile.png" ) }}"
                         obj_id="{{ post.id }}" url = "like_post"  />

                {% elif dict[post.id] == "funny" %}
                    <img class="liked" src="{{ url_for('static',filename="image/funny.png" ) }}"
                         obj_id="{{ post.id }}" url = "like_post" />


                {% elif dict[post.id] == "angry" %}
                    <img class="liked" src="{{ url_for('static',filename="image/angry.png" ) }}"
                         obj_id="{{ post.id }}" url = "like_post"  />

                {% endif %}


        </div>
        </div>

        {% else %}

            <div class="smile-container">
                <div class="parent_div">

                    {{ popup_div_macro(post.id, "like_post ") }}
                    <img class="unliked" src="{{ url_for('static',filename="image/gray.png" ) }}"
                         url="like_post" obj_id="{{ post.id }}"/>
                </div>
            </div>

        {% endif %}
        <span id="like_count_like_post_{{ post.id }}">{{ post.like_count }} </span><img class="smile"
                                                                                        src="{{ url_for('static',filename="image/like_smile.png" ) }}"
                                                                                        width=20/>
        <span id="unlike_count_like_post_{{ post.id }}">{{ post.unlike_count }} </span><img class="smile"
                                                                                            src="{{ url_for('static',filename="image/unlike_smile.png" ) }}"
                                                                                            width=20/>
        <span id="funny_count_like_post_{{ post.id }}">{{ post.funny_count }} </span><img class="smile"
                                                                                          src="{{ url_for('static',filename="image/funny.png" ) }}"
                                                                                          width=20/>
        <span id="angry_count_like_post_{{ post.id }}">{{ post.angry_count }} </span><img class="smile"
                                                                                          src="{{ url_for('static',filename="image/angry.png" ) }}"
                                                                                          width=20/>




        {% if post in list_of_favourite %}
            <span class="star post" id="star_gold{{ post.id }}">Delete_saved</span>&nbsp;
            <img class="post" id="gold_star" src="{{ url_for('static',filename="image/gold_star.png" ) }}"
                 width="20" post_id="{{ post.id }}"/></a>
        {% else %}
            <span class="star post" id="star_white{{ post.id }}">Add_to_saved</span>&nbsp;
            <img class="post" id="white_star" src="{{ url_for('static',filename="image/white_star.png" ) }}"
                 width="20" post_id="{{ post.id }}"/></a>
        {% endif %}


    </div>
{%- endmacro %}



{#generate product_boxes#}
{% macro products_macro(product, dict, list_of_favourite, md ) -%}
    <div class="product_box col-xs-12 col-sm-5 col-md-{{ md }}">
        <div class="product_title">
            <h4>
                <a href="{{ url_for('singleproduct', product_id=product.id) }}">{{ product.title|truncate(10, True) }}</a>
            </h4> <br>
        </div>
        <div class="is_image product">
        {% if product.image %}
            <img src="{{ url_for('static',filename="media/" + product.image) }}"/><br>
        {% else %}
            <img src="{{ url_for('static',filename="image/default_product.jpg") }}" width="100px"/><br>
        {% endif %}
        </div>

        <div class="product_description">
            {{ product.description|truncate(50, True) }}
        </div>
        <div class="price">

            {{ product.price }}


        </div>


        <span>   Write {{ product.product_author.username }} </span><br>
        <hr class="myhrline product"/>


        {% if dict[product.id] %}

            <div class="smile-container">
                <div class="parent_div">

                    {{ popup_div_macro(product.id, "like_product ") }}

                    {% if dict[product.id] == "like" %}
                        <img class="liked" src="{{ url_for('static',filename="image/like_smile.png" ) }}"
                             obj_id="{{ product.id }}" url = "like_product" />

                    {% elif dict[product.id] == "unlike" %}
                        <img class="liked" src="{{ url_for('static',filename="image/unlike_smile.png" ) }}"
                             obj_id="{{ product.id }}" url = "like_product"  />

                    {% elif dict[product.id] == "funny" %}
                        <img class="liked" src="{{ url_for('static',filename="image/funny.png" ) }}"
                             obj_id="{{ product.id }}" url = "like_product" />


                    {% elif dict[product.id] == "angry" %}
                        <img class="liked" src="{{ url_for('static',filename="image/angry.png" ) }}"
                             obj_id="{{ product.id }}" url = "like_product"  />


                    {% endif %}
                </div>
            </div>

        {% else %}

            <div class="smile-container">
                <div class="parent_div">

                    {{ popup_div_macro(product.id, "like_product ") }}
                    <img class="unliked" src="{{ url_for('static',filename="image/gray.png" ) }}"
                         url="like_product" obj_id="{{ product.id }}"/>
                </div>
            </div>

        {% endif %}
        <span id="like_count_like_product_{{ product.id }}">{{ product.like_count }} </span><img class="smile"
                                                                                                 src="{{ url_for('static',filename="image/like_smile.png" ) }}"
                                                                                                 width=20/>
        <span id="unlike_count_like_product_{{ product.id }}">{{ product.unlike_count }} </span><img class="smile"
                                                                                                     src="{{ url_for('static',filename="image/unlike_smile.png" ) }}"
                                                                                                     width=20/>
        <span id="funny_count_like_product_{{ product.id }}">{{ product.funny_count }} </span><img class="smile"
                                                                                                   src="{{ url_for('static',filename="image/funny.png" ) }}"
                                                                                                   width=20/>
        <span id="angry_count_like_product_{{ product.id }}">{{ product.angry_count }} </span><img class="smile"
                                                                                                   src="{{ url_for('static',filename="image/angry.png" ) }}"
                                                                                                   width=20/>



        {% if product in list_of_favourite %}
            <span class="star product" id="star_gold{{ product.id }}">Delete_saved</span>&nbsp;
            <img class="product" id="gold_star" src="{{ url_for('static',filename="image/gold_star.png" ) }}"
                 width="20" product_id="{{ product.id }}"/></a>
        {% else %}
            <span class="star product" id="star_white{{ product.id }}">Add_to_saved</span>&nbsp;
            <img class="product" id="white_star" src="{{ url_for('static',filename="image/white_star.png" ) }}"
                 width="20" product_id="{{ product.id }}"/></a>
        {% endif %}


    </div>

{%- endmacro %}



{#generate div with four different reaction when mouse hover on smile#}
{% macro popup_div_macro(id, url) -%}
    <div class="popup-div" obj_id={{ id }} url={{ url }}>
        <img class="smile" src="{{ url_for('static',filename="image/like_smile.png" ) }}" obj_id={{ id }} width="40"
             type="like" url={{ url }}/>
        <img class="smile" src="{{ url_for('static',filename="image/unlike_smile.png" ) }}" obj_id={{ id }} width="40"
             type="unlike" url={{ url }}/>
        <img class="smile" src="{{ url_for('static',filename="image/funny.png" ) }}" obj_id={{ id }} width="40"
             type="funny" url={{ url }}/>
        <img class="smile" src="{{ url_for('static',filename="image/angry.png" ) }}" obj_id={{ id }} width="45"
             type="angry" url={{ url }}/>
    </div>
{% endmacro %}


{% macro render_field(field) %}
    {{ field.label }}
    {% if field.errors %}
        <ul class="errors">
            {% for error in field.errors %}
                <li>{{ error }}</li>
            {% endfor %}
        </ul>
    {% endif %}
    {{ field(**kwargs)|safe }}
{% endmacro %}